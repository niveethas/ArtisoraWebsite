@page "/showcaseManager"
@using ArtisoraServer
@inject NotificationService notif
@inject NavigationManager nav

<RadzenDialog />
<RadzenNotification />
<PageTitle>View Showcases</PageTitle>

<div class="rz-m-10">

    <RadzenText class="rz-my-3 rz-border-radius-6 rz-shadow-3 rz-color-white rz-p-12" TextStyle="TextStyle.H4" TextAlign="TextAlign.Center" Style="height: 100%; background: var(--rz-primary-light) 100% 70% fixed url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwNCIgaGVpZ2h0PSIxNDU4IiB2aWV3Qm94PSIwIDAgMTIwNCAxNDU4IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8ZyBvcGFjaXR5PSIwLjUiIGZpbHRlcj0idXJsKCNmaWx0ZXIwX2ZfNDkzXzEwMTM0KSI+CjxjaXJjbGUgY3g9IjcyMi4xMjgiIGN5PSI4MzkuMDIiIHI9IjQ4MS40MTkiIGZpbGw9InVybCgjcGFpbnQwX3JhZGlhbF80OTNfMTAxMzQpIi8+CjwvZz4KPGcgb3BhY2l0eT0iMC41IiBmaWx0ZXI9InVybCgjZmlsdGVyMV9mXzQ5M18xMDEzNCkiPgo8Y2lyY2xlIGN4PSI0NzAuMzMzIiBjeT0iNTcwLjMzMyIgcj0iNDcwLjMzMyIgZmlsbD0idXJsKCNwYWludDFfcmFkaWFsXzQ5M18xMDEzNCkiLz4KPC9nPgo8ZyBvcGFjaXR5PSIwLjUiIGZpbHRlcj0idXJsKCNmaWx0ZXIyX2ZfNDkzXzEwMTM0KSI+CjxjaXJjbGUgY3g9IjY5MS41MTEiIGN5PSI1MjIuMjk3IiByPSIzMzEuNTAzIiBmaWxsPSJ1cmwoI3BhaW50Ml9yYWRpYWxfNDkzXzEwMTM0KSIvPgo8L2c+CjxnIG9wYWNpdHk9IjAuNSIgZmlsdGVyPSJ1cmwoI2ZpbHRlcjNfZl80OTNfMTAxMzQpIj4KPGNpcmNsZSBjeD0iNjA4LjI0NCIgY3k9IjEwNzkuOTciIHI9IjMzMS41MDMiIHRyYW5zZm9ybT0icm90YXRlKC04MS4yMjQ0IDYwOC4yNDQgMTA3OS45NykiIGZpbGw9InVybCgjcGFpbnQzX3JhZGlhbF80OTNfMTAxMzQpIi8+CjwvZz4KPGRlZnM+CjxmaWx0ZXIgaWQ9ImZpbHRlcjBfZl80OTNfMTAxMzQiIHg9IjE0MC43MDkiIHk9IjI1Ny42MDEiIHdpZHRoPSIxMTYyLjg0IiBoZWlnaHQ9IjExNjIuODQiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj4KPGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz4KPGZlQmxlbmQgbW9kZT0ibm9ybWFsIiBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0ic2hhcGUiLz4KPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iNTAiIHJlc3VsdD0iZWZmZWN0MV9mb3JlZ3JvdW5kQmx1cl80OTNfMTAxMzQiLz4KPC9maWx0ZXI+CjxmaWx0ZXIgaWQ9ImZpbHRlcjFfZl80OTNfMTAxMzQiIHg9Ii0xMDAiIHk9IjAiIHdpZHRoPSIxMTQwLjY3IiBoZWlnaHQ9IjExNDAuNjciIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj4KPGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz4KPGZlQmxlbmQgbW9kZT0ibm9ybWFsIiBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0ic2hhcGUiLz4KPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iNTAiIHJlc3VsdD0iZWZmZWN0MV9mb3JlZ3JvdW5kQmx1cl80OTNfMTAxMzQiLz4KPC9maWx0ZXI+CjxmaWx0ZXIgaWQ9ImZpbHRlcjJfZl80OTNfMTAxMzQiIHg9IjI2MC4wMDgiIHk9IjkwLjc5MzkiIHdpZHRoPSI4NjMuMDA2IiBoZWlnaHQ9Ijg2My4wMDYiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj4KPGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz4KPGZlQmxlbmQgbW9kZT0ibm9ybWFsIiBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0ic2hhcGUiLz4KPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iNTAiIHJlc3VsdD0iZWZmZWN0MV9mb3JlZ3JvdW5kQmx1cl80OTNfMTAxMzQiLz4KPC9maWx0ZXI+CjxmaWx0ZXIgaWQ9ImZpbHRlcjNfZl80OTNfMTAxMzQiIHg9IjE3Ni42OTQiIHk9IjY0OC40MjMiIHdpZHRoPSI4NjMuMSIgaGVpZ2h0PSI4NjMuMSIgZmlsdGVyVW5pdHM9InVzZXJTcGFjZU9uVXNlIiBjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnM9InNSR0IiPgo8ZmVGbG9vZCBmbG9vZC1vcGFjaXR5PSIwIiByZXN1bHQ9IkJhY2tncm91bmRJbWFnZUZpeCIvPgo8ZmVCbGVuZCBtb2RlPSJub3JtYWwiIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9IkJhY2tncm91bmRJbWFnZUZpeCIgcmVzdWx0PSJzaGFwZSIvPgo8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSI1MCIgcmVzdWx0PSJlZmZlY3QxX2ZvcmVncm91bmRCbHVyXzQ5M18xMDEzNCIvPgo8L2ZpbHRlcj4KPHJhZGlhbEdyYWRpZW50IGlkPSJwYWludDBfcmFkaWFsXzQ5M18xMDEzNCIgY3g9IjAiIGN5PSIwIiByPSIxIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSg3MjIuMTI4IDgzOS4wMikgcm90YXRlKDkwKSBzY2FsZSg0ODEuNDE5KSI+CjxzdG9wIHN0b3AtY29sb3I9IiNGRjFBNkMiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjRkYxQTZDIiBzdG9wLW9wYWNpdHk9IjAiLz4KPC9yYWRpYWxHcmFkaWVudD4KPHJhZGlhbEdyYWRpZW50IGlkPSJwYWludDFfcmFkaWFsXzQ5M18xMDEzNCIgY3g9IjAiIGN5PSIwIiByPSIxIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSg0NzAuMzMzIDU3MC4zMzMpIHJvdGF0ZSg5MCkgc2NhbGUoNDcwLjMzMykiPgo8c3RvcCBzdG9wLWNvbG9yPSIjM0FBQ0ZGIi8+CjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iIzNBOTVGRiIgc3RvcC1vcGFjaXR5PSIwIi8+CjwvcmFkaWFsR3JhZGllbnQ+CjxyYWRpYWxHcmFkaWVudCBpZD0icGFpbnQyX3JhZGlhbF80OTNfMTAxMzQiIGN4PSIwIiBjeT0iMCIgcj0iMSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGdyYWRpZW50VHJhbnNmb3JtPSJ0cmFuc2xhdGUoNjkxLjUxMSA1MjIuMjk3KSByb3RhdGUoOTApIHNjYWxlKDMzMS41MDMpIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzQ4M0FGRiIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM0ODNBRkYiIHN0b3Atb3BhY2l0eT0iMCIvPgo8L3JhZGlhbEdyYWRpZW50Pgo8cmFkaWFsR3JhZGllbnQgaWQ9InBhaW50M19yYWRpYWxfNDkzXzEwMTM0IiBjeD0iMCIgY3k9IjAiIHI9IjEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBncmFkaWVudFRyYW5zZm9ybT0idHJhbnNsYXRlKDYwOC4yNDQgMTA3OS45Nykgcm90YXRlKDkwKSBzY2FsZSgzMzEuNTAzKSI+CjxzdG9wIHN0b3AtY29sb3I9IiNGRkM4M0EiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjRkZDODNBIiBzdG9wLW9wYWNpdHk9IjAiLz4KPC9yYWRpYWxHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K')">View Your Showcases</RadzenText>
    <RadzenTabs @bind-SelectedIndex=@selectedTab>
    <Tabs>
        <RadzenTabsItem Text="View Showcases" >
            <div class="rz-m-10">
                @if (showcases != null)
                {
                    <RadzenRow class="rz-text-align-center" Gap="2rem" RowGap="2rem">
                    @foreach (var s in showcases)
                    {
                        <RadzenCard class="rz-shadow-6 rz-border-radius-6 rz-p-12 rz-my-12">
                        <RadzenStack>
                            <RadzenText TextStyle="TextStyle.Overline" TextAlign="TextAlign.Center">Showcase No.: @s.ShowcaseId</RadzenText>
                            <RadzenText TextStyle="TextStyle.Body1" TextAlign="TextAlign.Center">@s.SelfDescription</RadzenText>
                        </RadzenStack>
                        <RadzenColumn class=" rz-color-secondary-lighter rz-p-5">
                            <RadzenStack Orientation="Orientation.Vertical" class="rz-py-5">
                                            <RadzenImage Style="max-width:100%;" Path="@s.Image1"></RadzenImage>
                                <RadzenText TextStyle="TextStyle.Caption">@s.Image1Caption</RadzenText>
                            </RadzenStack>
                        </RadzenColumn>
                        <RadzenColumn  class=" rz-color-secondary-lighter rz-p-5">
                            <RadzenStack Orientation="Orientation.Vertical" class="rz-py-5">
                                            <RadzenImage Style="max-width:100%;" Path="@s.Image2"></RadzenImage>
                                <RadzenText TextStyle="TextStyle.Caption">@s.Image2Caption</RadzenText>
                            </RadzenStack>
                        </RadzenColumn>
                        <RadzenColumn  class=" rz-color-secondary-lighter rz-p-5">
                            <RadzenStack Orientation="Orientation.Vertical" class="rz-py-5">
                                            <RadzenImage Style="max-width:100%;" Path="@s.Image3"></RadzenImage>
                                <RadzenText TextStyle="TextStyle.Caption">@s.Image3Caption</RadzenText>
                            </RadzenStack>
                        </RadzenColumn>
                        </RadzenCard>
                    }
                    </RadzenRow>
                }
                else{
                    <RadzenText TextAlign="TextAlign.Left" TextStyle="TextStyle.Subtitle1">You have not added any showcases yet! Please add a showcase below to be displayed publicly!</RadzenText>
                }
                </div>
        </RadzenTabsItem>


        <RadzenTabsItem Text="Add Showcase">
            <div class="rz-m-10">
                <RadzenCard Class="rz-shadow-10 rz-border-radius-6 rz-p-12">
                    <RadzenText TextAlign="TextAlign.Center" TextStyle="TextStyle.H4">Add New Showcase</RadzenText>
                    <RadzenText TextAlign="TextAlign.Center" TextStyle="TextStyle.Caption" class="rz-color-danger">* All fields are required.</RadzenText>

                    <RadzenTemplateForm TItem="ShowcaseDTO" Data="newShowcase">
                        <RadzenStack Orientation="Orientation.Vertical" class="rz-my-12">
                            <RadzenLabel Text="Enter Self-Description" />
                            <RadzenText TextStyle ="TextStyle.Caption">Ensure to add your email and other contact details. Describe the showcase content and what skills you will provide.</RadzenText>
                            <RadzenTextBox Name="description" @bind-Value=@newShowcase.SelfDescription></RadzenTextBox>
                        </RadzenStack>  
                        <RadzenStack Orientation="Orientation.Vertical" class="rz-my-12">
                            <RadzenLabel Text="Upload First Image" />
                            <RadzenUpload Auto="true" Error=@(args => uploadError(args)) ChooseText="Choose Image 1" Multiple="false" class="w-100" Url="https://localhost:7123/showcase/upload" Complete=@(args => uploadComplete1(args)) />
                            <RadzenTextBox Name = "image1Cap" @bind-Value=@newShowcase.Image1Caption Placeholder="Enter caption for image 1..."></RadzenTextBox>
                        </RadzenStack>
                        <RadzenStack Orientation="Orientation.Vertical" class="rz-my-12">
                            <RadzenLabel Text="Upload Second Image" />
                            <RadzenUpload Auto="true" Error=@(args => uploadError(args)) ChooseText="Choose Image 2" Multiple="false" class="w-100" Url="https://localhost:7123/showcase/upload" Complete=@(args => uploadComplete2(args)) />
                            <RadzenTextBox Name="image2Cap" @bind-Value=@newShowcase.Image2Caption Placeholder="Enter caption for image 2..."></RadzenTextBox>
                        </RadzenStack>
                        <RadzenStack Orientation="Orientation.Vertical" class="rz-my-12">
                            <RadzenLabel Text="Upload Third Image" />
                            <RadzenUpload Auto="true" Error=@(args => uploadError(args)) ChooseText="Choose Image 3" Multiple="false" class="w-100" Url="https://localhost:7123/showcase/upload" Complete=@(args => uploadComplete3(args)) />
                            <RadzenTextBox Name="image3Cap" @bind-Value=@newShowcase.Image3Caption Placeholder="Enter caption for image 3..."></RadzenTextBox>
                        </RadzenStack>
                        <RadzenButton ButtonType="ButtonType.Submit" Text="Save New Showcase" Click="@(()=>createShowcase(newShowcase))"></RadzenButton>
                    </RadzenTemplateForm>
                 </RadzenCard>
            </div>
        </RadzenTabsItem>
        
    </Tabs>
</RadzenTabs>
    

        @*@if (showI1.Equals("True"))
        {
            <RadzenImage Path="@filePath1" Style="width:300px;"></RadzenImage>
        }
        @if (showI2.Equals("True"))
        {
            <RadzenImage Path="@filePath2" Style="width:300px;"></RadzenImage>
        }
        @if (showI3.Equals("True"))
        {
            <RadzenImage Path="@filePath3" Style="width:300px;"></RadzenImage>
        }*@
</div>

@code {
    [Inject]
    public ClientAPI? _api { get; set; }

    public ICollection<Showcase>? showcases = new List<Showcase>();
    public int? currentUserID = CurrentUser._userid;
    ShowcaseDTO newShowcase = new ShowcaseDTO();
    public string? filePath1, filePath2, filePath3;
    public string? showI1, showI2, showI3 = "False";
    //can be used to show the images in future development
    public int selectedTab = 0;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            showcases = await _api.ShowcasesAsync(currentUserID);
            Console.WriteLine(currentUserID);
        }
        catch (Exception x){
            showcases = null;
            Console.WriteLine(x);
        }

    }

    void uploadError(UploadErrorEventArgs args)
    {
        var notifMsg = new NotificationMessage { Severity = NotificationSeverity.Warning, Summary = "Error", Detail = "File submission failed.", Duration = 4000 };
        notif.Notify(notifMsg);
    }

    async void uploadComplete1(UploadCompleteEventArgs args)
    {

        filePath1 = @"\ShowcaseImages\" + args.RawResponse;
        var notifMsg = new NotificationMessage
            {
                Style = "position:absolute;bottom: 0; " , Severity = NotificationSeverity.Info, Summary = "Updated", Detail = "Image 1 has been saved, add caption.", Duration = 4000 };
        notif.Notify(notifMsg);
    }

    async void uploadComplete2(UploadCompleteEventArgs args)
    {
        filePath2 = @"\ShowcaseImages\" + args.RawResponse;
        showI2 = "True";
        var notifMsg = new NotificationMessage { Severity = NotificationSeverity.Info, Summary = "Updated", Detail = "Image 2 has been saved, add caption.", Duration = 4000 };
        notif.Notify(notifMsg);
    }
    async void uploadComplete3(UploadCompleteEventArgs args)

    {
        filePath3 = @"\ShowcaseImages\" + args.RawResponse;
        showI3 = "True";
        var notifMsg = new NotificationMessage { Severity = NotificationSeverity.Info, Summary = "Updated", Detail = "Image 3 has been saved, add caption.", Duration = 4000 };
        notif.Notify(notifMsg);
    }


    public async Task createShowcase(ShowcaseDTO newSC){
        if (newSC.Image1Caption != string.Empty && newSC.Image2Caption != string.Empty && newSC.Image3Caption != string.Empty && newSC.SelfDescription != string.Empty) {
            //checks that all mandatory fields have been entered
            try
            {
                var currentEmail = CurrentUser._useremail;
                int mentorid = await _api.Id3Async(currentEmail);

                var tempSC = new ShowcaseDTO
                    {
                        Image1 = filePath1,
                        Image1Caption = newSC.Image1Caption,
                        Image2 = filePath2,
                        Image2Caption = newSC.Image2Caption,
                        Image3 = filePath3,
                        Image3Caption = newSC.Image3Caption,
                        SelfDescription = newSC.SelfDescription,
                        MentorId = mentorid
                    };
                await _api.New6Async(tempSC);
                var notifMsg = new NotificationMessage { Severity = NotificationSeverity.Success, Summary = "Uploaded!", Detail = "Your upload has been successfully saved!", Duration = 4000 };
                notif.Notify(notifMsg);
                showI1 = "False";
                showI2 = "False";
                showI3 = "False";
                //reseting image showing
                nav.NavigateTo("/showcase");
            }
            catch (Exception e)
            {
                var notifMsg = new NotificationMessage { Severity = NotificationSeverity.Error, Summary = "Error", Detail = "File upload failed to save. Please try again.", Duration = 4000 };
                notif.Notify(notifMsg);
            }
        }else {
            var notifMsg = new NotificationMessage { Severity = NotificationSeverity.Warning, Summary = "Empty Values", Detail = "Please fill in every field. Please try again.", Duration = 4000 };
            notif.Notify(notifMsg);
        }
    }
}
